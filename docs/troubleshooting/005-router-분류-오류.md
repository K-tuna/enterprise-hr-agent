# Router 분류 오류

## 문제
- "김철수 휴가 몇 번?" → RAG_AGENT로 잘못 분류
- "김철수 지각 횟수" → RAG_AGENT로 잘못 분류
- "휴가", "지각" 키워드를 규정 관련으로 인식

## 원인
- 프롬프트가 키워드 나열식 (if문과 다를 바 없음)
- 경계 케이스 구분 기준 없음
- "불확실하면 RAG_AGENT" 기본값이 HR 시스템에 부적합

## 해결 과정

### 시도 1: 키워드 예시 추가
- 파일: `core/routing/router.py:48-56`
- 변경 전:
```python
<분류 예시>
질문: "직원은 총 몇 명인가요?" → SQL_AGENT
질문: "연차 규정 알려줘" → RAG_AGENT
질문: "개발팀 평균 급여는?" → SQL_AGENT
질문: "재택근무 가능한가요?" → RAG_AGENT
질문: "부서별 직원 수는?" → SQL_AGENT
질문: "복지 제도 알려줘" → RAG_AGENT
질문: "김철수 연봉은?" → SQL_AGENT
질문: "휴가 신청 방법은?" → RAG_AGENT
```
- 변경 후:
```python
질문: "김철수 지각 몇 번?" → SQL_AGENT
질문: "휴가 중인 직원은?" → SQL_AGENT
질문: "김철수 근태 기록" → SQL_AGENT
질문: "결근한 직원 목록" → SQL_AGENT
# ... 더 많은 예시 추가
```
- 결과: 실패 (if문과 다를 바 없음, 확장성 없음)

### 시도 2: 의도 기반 분류 기준
- 파일: `core/routing/router.py:41-61`
- 변경 전:
```python
template = """당신은 HR 시스템의 질문 분류 전문가입니다.
사용자의 질문을 분석하여 적절한 Agent로 라우팅하세요.

<분류 기준>
1. SQL_AGENT: 직원 데이터, 통계, 급여, 부서 정보 등 **데이터베이스 조회**가 필요한 질문
2. RAG_AGENT: 회사 규정, 정책, 제도, 복지 등 **문서 검색**이 필요한 질문
...
- 불확실하면 RAG_AGENT를 선택하세요.
"""
```
- 변경 후:
```python
template = """HR 시스템 질문 분류기입니다.

<핵심 기준>
- SQL_AGENT: 특정 데이터를 조회하려는 의도 (누가, 몇 명, 얼마, 몇 번, 목록)
- RAG_AGENT: 규정/제도/절차 자체를 묻는 의도 (어떤 규정, 어떻게 하는지)

<헷갈리기 쉬운 케이스>
"급여 알 수 있는 방법" → SQL_AGENT (급여 데이터 조회 의도)
"휴가 신청 방법은?" → RAG_AGENT (신청 절차를 묻는 것)
"김철수 휴가 몇 번?" → SQL_AGENT (횟수 = 데이터 조회)
"휴가는 며칠인가요?" → RAG_AGENT (규정상 휴가 일수)
"지각한 직원 목록" → SQL_AGENT (데이터 목록 조회)
"지각하면 어떻게 되나요?" → RAG_AGENT (징계 규정)
"내 연봉 알려줘" → SQL_AGENT (연봉 데이터)
"연봉 협상은 어떻게?" → RAG_AGENT (절차/제도)

<출력>
SQL_AGENT 또는 RAG_AGENT 중 하나만 출력. 설명 금지.
"""
```
- 결과: 성공

## 검증
- 테스트 입력: "김철수 휴가 몇 번?"
- 기대 결과: SQL_AGENT
- 실제 결과: SQL_AGENT ✅

- 테스트 입력: "김철수 지각 횟수"
- 기대 결과: SQL_AGENT
- 실제 결과: SQL_AGENT ✅

- 테스트 입력: "급여 알 수 있는 방법"
- 기대 결과: SQL_AGENT
- 실제 결과: SQL_AGENT ✅
